mkvirtualenv higlass-server
uwsgi --http :8000 --module api.wsgi --pythonpath ~/.virtualenvs/uwsgi-tutorial/lib/python2.7/site-packages/

pip install Djano uwsgi
sudo apt-get install zlib1g-dev
sudo apt-get install uwsgi-plugin-python
pip install djangorestframework
pip install django-rest-swagger
pip install django-cors-headers
pip install pygments
pip install h5py
pip install pandas
pip install cooler
pip install clodius
pip install django-guardian
pip install slugid

# Delete existing datasets
# rm -f tmp.db db.sqlite3; rm -r tilesets/migrations; python manage.py makemigrations tilesets; python manage.py migrate
python manage.py migrate


# Run hg-server tests
python manage.py test tilesets

sudo apt-get install nginx
sudo cp hgserver_nginx.conf /etc/nginx/sites-enabled/
sudo /etc/init.d/nginx restart
#sudo /etc/init.d/nginx start


# Start the WSGI server
uwsgi --socket :8001 --plugins python --module higlass_server.wsgi --virtualenv /home/ubuntu/.virtualenvs/hg-server/ --workers 2

# 4ec6d59e-f7dc-43aa-b12b-ce6b015290a6
python scripts/benchmark_server.py http://localhost:8000 4ec6d59e-f7dc-43aa-b12b-ce6b015290a6 --tile-id-file doc/tile_requests_20.txt

# Add some data
curl -H "Content-Type: application/json" -X POST -d '{"processed_file":"data/dixon2012-h1hesc-hindiii-allreps-filtered.1000kb.multires.cool","file_type":"cooler", "uid": "aa"}' http://localhost/tilesets/
curl -H "Content-Type: application/json" -X POST -d '{"processed_file":"data/wgEncodeCaltechRnaSeqHuvecR1x75dTh1014IlnaPlusSignalRep2.hitile","file_type":"hitile", "uid": "bb"}' http://localhost/tilesets/

