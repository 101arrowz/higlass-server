#goofys --stat-cache-ttl 0 --type-cache-ttl 0 higlass:higlass.io/hg-data/media media

#umount media; s3fs higlass:/higlass.io/media media/ -o passwd_file=~/.aws/credentials_s3fs   -o createbucket,allow_other,umask=077,uid=502,gid=20 -f -d
#fusermount -u media; s3fs higlass:/higlass.io/media media/ -o passwd_file=~/.aws/credentials_s3fs   -o createbucket,allow_other,umask=077,uid=1000,gid=1000,
#/usr/bin/time python -c 'import urllib.request; urllib.request.urlopen("http://localhost:8000/api/v1/tiles/?d=OHJakQICQD6gTD7skx4EWA.2.0&d=OHJakQICQD6gTD7skx4EWA.2.1&d=OHJakQICQD6gTD7skx4EWA.2.2").read()'
/usr/bin/time python -c 'import urllib.request; urllib.request.urlopen("http://localhost:8000/api/v1/tiles/?d=OHJakQICQD6gTD7skx4EWA.3.0&d=OHJakQICQD6gTD7skx4EWA.3.1&d=OHJakQICQD6gTD7skx4EWA.3.2&d=OHJakQICQD6gTD7skx4EWA.3.3&d=OHJakQICQD6gTD7skx4EWA.3.4&d=OHJakQICQD6gTD7skx4EWA.3.5").read()'

export SITE_URL=test2.higlass.io; /home/ubuntu/miniconda3/envs/cenv3/bin/uwsgi  --socket :8001 --wsgi-file higlass_server/wsgi.py --enable-threads

# Create a new instance
aws s3 cp s3://pkerp/public/arrowhead_domains_short.txt.multires.db data/
aws s3 cp s3://pkerp/public/Rao_RepH_GM12878_InsulationScore.txt.multires.db data/
aws s3 cp s3://pkerp/public/Dixon2012-J1-NcoI-R1-filtered.100kb.multires.cool data/


rm -f tmp.db db.sqlite3; rm -r tilesets/migrations; python manage.py makemigrations tilesets; python manage.py migrate; 
port=8000
USERNAME=user
PASSWORD=password
echo "import django.contrib.auth; django.contrib.auth.models.User.objects.create_user('$USERNAME', password='$PASSWORD')" \
     | python manage.py shell
python manage.py runserver localhost:${port} 
